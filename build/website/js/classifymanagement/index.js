webpackJsonp([8],{0:function(e,t,n){e.exports=n(59)},59:function(e,t,n){(function(e){function t(t){util.loading.show();var n=e.Deferred();return e.ajax({url:config.orgUrl,data:t,success:function(e){0===e.status?n.resolve(e.data):(o({msg:e.msg||"获取分类数据失败"}),n.reject())},error:function(){o({msg:"服务器无响应,获取分类数据失败"}),n.reject()}}),n.promise()}function i(t){console.log(t),e(".org-tree").jstree({core:{check_callback:!0,data:t},types:{users:{icon:"icon icon-user"}},plugins:["types"]}),t.length<=0&&e(".init-wrap").show()}function o(e){util&&util.prompt&&util.prompt({text:e.msg})}function r(t){var n=e(".root-name").val().trim();return n?n.length>30?void o({msg:"分类名称为1-30位字符"}):void a({name:n}):void o({msg:"请输入分类名称"})}function a(t){e.ajax({url:config.nodeUrl,data:t,success:function(n){if(util.loading.hide(),0!==n.status)o({msg:n.msg||"创建一级分类失败"});else{var i=e(".org-tree").jstree(!0);i.create_node("#",{text:t.name,id:n.data.id});console.log(t),e(".init-save-wrap").hide(),e(".org-tree").fadeIn()}},error:function(){o({msg:"服务器无响应,创建一级分类失败"}),util.loading.hide()}})}function s(t){function n(){r.edit(a,g,function(){var e=r.get_text(a).trim(),s=!0;return e===g&&(o({msg:"请输入分类名称"}),s=!1),(e.length<1||e.length>30)&&(o({msg:"分类名称为1-30位字符"}),s=!1),d.hasOwnProperty(e)&&""!==d[e]&&(s=!1,o({msg:"同一级别下的分类名称不能重复"})),s===!1?void n():(t.name=e,void i.resolve(t))})}var i=e.Deferred(),r=e(".org-tree").jstree(!0);t.id=(new Date).getTime();var a=r.create_node(t.parentId+"_anchor",{id:t.id});console.log(a);for(var s=r.get_children_dom(t.parentId+"_anchor"),d={},l=0,c=s.length;l<c;l++){var u=e(s[l]).find(".jstree-anchor").text().trim();d[u]=!0}console.log(d),console.log(s);var g="请输入分类名称";return n(),i.promise()}function d(){function t(){n.edit(i+"_anchor",r,function(){var e=n.get_text(i).trim();return e.length<1||e.length>30?(o({msg:"分类名称为1-30位字符"}),void t()):void g({id:i,name:n.get_text(i)})})}var n=e(".org-tree").jstree(!0),i=e(this).parents(".jstree-node").attr("id"),r=n.get_text(i);t()}function l(){var t=e(".org-tree").jstree(!0),n=e(this).parents(".jstree-node").attr("id"),i=t.get_children_dom(n);return i.length>0?void o({msg:"该分类下有其他分类，不能删除"}):void new dialog({id:"delete",title:"提示",content:'<div class="my-dialog-wrap"><div class="my-dialog-left"><em class="my-dialog-icon icon-bounce"></em></div><div class="my-dialog-right"><p class="my-dialog-strong">确认删除？</p><p class="my-dialog-red">注：删除成功之后，该操作将无法恢复</p></div></div>',button:[{value:"确定",autofocus:!0,callback:function(){e.when(c({id:n})).then(function(){t.delete_node(n+"_anchor"),e(".org-tree li.jstree-node").length<=0&&e(".init-wrap").fadeIn()}).always(function(){util.loading.hide()})}},{value:"取消"}]}).showModal()}function c(t){util.loading.show();var n=e.Deferred();return e.ajax({url:config.deleteNode,data:t,success:function(e){0===e.status?n.resolve(e.data):(o({msg:e.msg||"删除分类失败"}),n.reject())},error:function(){o({msg:"服务器无响应,删除分类失败"}),n.reject()}}),n.promise()}function u(t){util.loading.show();var n=e(".org-tree").jstree(!0);e.ajax({url:config.nodeUrl,data:t,success:function(e){util.loading.hide(),0!==e.status?o({msg:e.msg||"更新分类id失败"}):n.set_id(t.id+"_anchor",e.data.id)},error:function(){o({msg:"服务器无响应,更新分类id失败"}),util.loading.hide()}})}function g(t){util.loading.show(),e.ajax({url:config.updateNode,data:t,success:function(e){util.loading.hide(),0!==e.status&&o({msg:e.msg||"更新分类失败"})},error:function(){o({msg:"服务器无响应,更新分类失败"}),util.loading.hide()}})}function f(){var t=(e(".org-tree").jstree(!0),e(this).parents(".jstree-node").attr("id"));e.when(s({parentId:t})).then(u).always(function(){util.loading.hide()})}n(3),n(7),n(9),n(13),n(15),n(36),n(39),n(40),n(41);e.when(t()).then(i).always(function(){util.loading.hide(),setTimeout(function(){var t=e(".org-tree").jstree(!0);t.open_all()},100)}),e(".btn-init").on("click",function(t){e(".init-wrap").hide(),e(".init-save-wrap").fadeIn(),e(".root-name").val("").focus()}),e(".btn-cancel").on("click",function(t){e(".init-wrap").fadeIn(),e(".init-save-wrap").hide()}),e(".btn-save").on("click",r),e("#mytree").on("mouseenter",".jstree-anchor",function(){e(this).find(".jstree-editable").length<=0&&e(this).append(e("#jstree-editable-tpl").html())}).on("mouseleave",".jstree-anchor",function(){e(this).find(".jstree-editable").remove()}),e(".org-tree").on("click",".jstree-editable .add",f),e(".org-tree").on("click",".jstree-editable .edit",d),e(".org-tree").on("click",".jstree-editable .del",l)}).call(t,n(2))}});